{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>As a consultant I get to see a lot of code bases and on Android, by far, the most common\nanti-pattern that I find is what I call the BaseClass anti-pattern.</p>\n<p>In this article I will explain what it is, why it is bad and why it is so seductive.</p>\n<h2>What is it?</h2>\n<p>So what is the BaseClass anti-pattern and how do I detect it?</p>\n<ol>\n<li>Start out by opening the android project.</li>\n<li>Locate an activity or a fragment class.</li>\n<li>Does it extend something called <code class=\"language-text\">BaseActivity</code> or <code class=\"language-text\">BaseFragment</code>?</li>\n</ol>\n<p>If the answer to #3 is yes then you my friend has fallen victim to the BaseClass anti-pattern.\nIf you open the <code class=\"language-text\">BaseActivity</code> or the <code class=\"language-text\">BaseFragment</code> class and that class contains more than\n50 lines of code then you're probably in deep trouble.</p>\n<h2>So why is this bad?</h2>\n<p>I will answer why it is bad by asking a question. What is the responsibility of the\n<code class=\"language-text\">BaseActivity</code>? Except for being an <code class=\"language-text\">Activity</code> what does the class name tell you?\n<strong>NOTHING</strong> right...</p>\n<p>So the naming is bad, lets give it a better name! Well if you open the class\nchances are that you will find something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token annotation punctuation\">@Inject</span>\n  Analytics analytics<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    AppInjector<span class=\"token punctuation\">.</span><span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    analytics<span class=\"token punctuation\">.</span><span class=\"token function\">trackScreen</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now try to come up with a name for this class, what is it responsible for?\n<code class=\"language-text\">ActivityWithInjectionAndAnalytics</code> is not a very nice name and the <em>\"And\"</em> part indicates\nthat the class has more than one responsibility and therefore is in violation\nof the <em>single responsibility principle</em>. So people resort to calling it things like\n<code class=\"language-text\">BaseActivity</code> and this creates a very <em>non-explicit</em> abstraction.</p>\n<p>So now you might think to your self that \"This doesn't look too bad\" and i would admit\nthat no, two methods are not the end of the world. However I this is usually not where the\nstory ends. I have found that such a <code class=\"language-text\">BaseClass</code> usually grows pretty linearly with time.\nIt starts to accumulate things like creating a <code class=\"language-text\">ViewModel</code> / <code class=\"language-text\">Presenter</code>, adding utility\nfunctions that depend on a <code class=\"language-text\">Context</code> and sometimes event business logic.</p>\n<p>As time goes on people start extending <code class=\"language-text\">BaseActivity</code> almost as a ritual rather than\nout of a need for some functionality that <code class=\"language-text\">BaseActivity</code> provides. Maybe you only care about\none of the 150 methods overridden in the <code class=\"language-text\">BaseActivity</code>. Once you get to that\npoint, what you have effectively done is creating a <em>static</em> dependency on code that\nyou in no way shape or form need to depend on. You run code that you don't need to run.\nMaybe the fact that the code runs doesn't hurt you (right now) but it will still run and I absolutely\npromise you that one day, someone (maybe you) wil modify some of the code in the base class\nto fit the need of a completely unrelated class and the class that you wrote in the first place\nwill have a <code class=\"language-text\">RuntimeException</code>. You or your colleague will be blamed, get fired and die alone.</p>\n<h2>So why use a BaseClass?</h2>\n<p>I can only guess but as someone who has created plenty of <code class=\"language-text\">BaseClass</code>es in the past\nI can say that it is mostly due to two things. The main reason why I did it was because\nit was the easiest way of implementing DRY (Do not repeat yourself). And the second reason\nwas that Android specific classes aren't that suited for the\n<a href=\"https://en.wikipedia.org/wiki/Decorator_pattern\">decorator pattern</a>.</p>\n<p>You probably had some piece of code, like dependency injection, that you thought: \"Hey I inject\nall of my activities in <code class=\"language-text\">onCreate</code> that is duplicated code, lets get rid of that!\". So you create\nyour initial base class that handles the injection and start hacking away. Later on you find some\nother piece of code that you run in a lot of the activities. For instance converting from <code class=\"language-text\">dp</code> to <code class=\"language-text\">px</code>.\nTo do this you need access to a <code class=\"language-text\">Context</code>. Since you learned in school that OOP is all about dat\ninheritance you just add a method to the <code class=\"language-text\">BaseClass</code> that does this. Of course what you should have\ndone is creating a static method in a different class:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Units</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">dpToPx</span><span class=\"token punctuation\">(</span>Context context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> dp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Resources resources <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">getResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> TypedValue<span class=\"token punctuation\">.</span><span class=\"token function\">applyDimension</span><span class=\"token punctuation\">(</span>\n        TypedValue<span class=\"token punctuation\">.</span>COMPLEX_UNIT_DIP<span class=\"token punctuation\">,</span>\n        dp<span class=\"token punctuation\">,</span>\n        resources<span class=\"token punctuation\">.</span><span class=\"token function\">getDisplayMetrics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now any class that needs this can call it. There is simply no need to inherit any <code class=\"language-text\">BaseClass</code> so the\ncaller of the method can sleep safe knowing that nothing strange runs in <code class=\"language-text\">onStart</code>, <code class=\"language-text\">onCreate</code> or any of\nthe other callback methods of the <code class=\"language-text\">Activity</code> class.</p>\n<p>If you can't get by with using a static helper method then create a class that handles your use case and\ninstantiate it in the <code class=\"language-text\">Activity</code>. Better yet, inject it with your dependency injector of choice!</p>\n<p>But what if we need to run something that depends on the callback methods? Like subscribing to some\nobservable data and then unsubscribing later on? Well in this case i would still prefer to be explicit with\nthis, over being implicit with a <code class=\"language-text\">BaseClass</code>. Luckily we have even better options today with\n<a href=\"https://developer.android.com/topic/libraries/architecture/lifecycle\">LifecycleObserver</a>.</p>\n<h2>Conclusion</h2>\n<p>DO NOT CREATE A BASE CLASS FOR ALL OF YOUR ACTIVITIES AND FRAGMENTS!</p>\n<p>It creates implicit but strong coupling. It makes it very hard to get a full picture of what an class does.\nIt will grow and become a hot mess. There is probably a lot of code in the <code class=\"language-text\">BaseClass</code> that would be really\neasy to unit test had it been in it's own class. But the fact that it is in the <code class=\"language-text\">BaseClass</code> makes you unwilling\nor unable to test it.</p>","excerpt":"As a consultant I get to see a lot of code bases and on Android, by far, the most common\nanti-pattern that I find is what I call the BaseClass anti-pattern. In this article I will explain what it is…","frontmatter":{"title":"The BaseClass Anti-Pattern","path":"/posts/base-class-anti-pattern"}}},{"node":{"html":"<p>This blog was made with <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a>. Over all it has\nbeen a blast to make and the fact that I could reuse my react skills made me\nfeel like I am in control.</p>\n<p>There were however some things that took some time to sink in. So I though it might\nbe nice to create a post about the concepts that were hard for me to grasp.</p>\n<p>I started out this blog post thinking it would be more or less a step by step guide of\nhow the Blog was made. But to be fair there are a lot of these guides out there and most\nof them are brilliantly written. So if you are looking for a step by step guide I\nwould much rather refer you to those:</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/blog/2017-07-19-creating-a-blog-with-gatsby/\">Creating a Blog with Gatsby</a></li>\n<li><a href=\"https://www.gatsbyjs.org/tutorial/\">Gatsby Official Tutorial</a></li>\n</ul>\n<h3>Initial Starter Pack</h3>\n<p>So one of the tings I wish that I had done differently was to start out with\nthe <em>hello world</em> starter pack instead of the default one.</p>\n<p>There are a lot of nice things in the default started pack like SEO, Manifest and\nall of that goodness. But before I understood how gatsby works, this\ninitial stuff became rather confusing.</p>\n<p>Therefore I strongly recommend anyone who wants to learn <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a>\nto initialize a project with:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">gatsby new hello-world https://github.com/gatsbyjs/gatsby-starter-hello-world</code></pre></div>\n<p>This is also what they recommend in the official tutorial so maybe I should have read\nthat he he.</p>\n<h3>What It Actually Does</h3>\n<p>So gatsby is a static page generator. It took some time for me to realize what is actually meant.\nI thought that it was more or less like writing any other React app.</p>\n<p>To wrap my head around this I had to separate the <em>build time</em> from <em>run time</em>. At <em>build time</em>\n<a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a> pulls in data from different sources and generate\npages from that data. Examples of sources are:</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/\">Filesystem</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-source-custom-api/\">Custom API</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/@mosch/gatsby-source-github/\">Github</a></li>\n</ul>\n<p>There are many more of these <em>source</em> plugins but I would advice someone who is just starting out\nto go with <a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/\">filesystem</a>.\nThis is because it makes it is easier create a mental image of how <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a>\nworks. It is easy to understand that these local files are managed at <em>build time</em> and not at <em>run time</em>.\nThe thing that I didn't really understand at first was that even if the <em>source</em> was an API,\n<strong>the data was still fetched at <em>build time</em></strong>.</p>\n<h3>Pages</h3>\n<p>Okay so lets talk basics. Pages are the most basic elements in\n<a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a>. When you create an app with the <em>hello world</em>\nstarter pack you will only have one page, the <em>index.js</em> page. This page it the one that the\nuser lands on. Another path will be added for each <em>page</em> that you add in the <em>pages</em> folder.</p>\n<p>Let say that I add an about page. <a href=\"https://www.gatsbyjs.org/\">Gatsby.js</a> will add a path for\n<em>/about</em>. You can now add a link from <em>/index</em> to <em>/about</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// index.js</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Link <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Index</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token operator\">&lt;</span>Link to<span class=\"token operator\">=</span><span class=\"token string\">\"/about\"</span><span class=\"token operator\">></span>About<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Link<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Index<span class=\"token punctuation\">;</span></code></pre></div>\n<h3>GraphQL</h3>\n<p>So before making this blog I had never really worked with GraphQL on a \"<em>real</em>\" project.\nI had played around with <a href=\"https://github.com/graphql/graphiql\">GraphiQL</a> but that was about\nall that I knew.</p>\n<p>As I mentioned Gatsby pulls data from your <em>sources</em> at <em>build time</em>. Once the data is fetched\nit exposes this data though GraphQL. I found that the easiest one to wrap my head around was\nonce again the <a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/\">filesystem</a>. So\nI strongly recommend that you use that one and then play around with some queries in the\n<a href=\"https://github.com/graphql/graphiql\">GraphiQL</a>. You can access <a href=\"https://github.com/graphql/graphiql\">GraphiQL</a>\nat <a href=\"localhost:8000/___grapgql\">localhost:8000/___grapgql</a>.</p>\n<p>GraphQL queries can be used pretty much all over Gatsby and it is really really powerful.</p>\n<h3>Transformers</h3>\n<p>So gatsby has a multitude of <em>transformers</em>. What <em>transformers</em> do is to take the\ncontent that the <em>source</em> plugins load and transform them in some way.</p>\n<p>I use <a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\">remark</a>. It is\na transformer for markdown (my choice when writing stuff). It takes any markdown available\nfrom the sources and then transforms it in to HTML that can then be queried and displayed.</p>\n<h3>Generating Pages From the Sources</h3>\n<p>So it is quite easy to imagine how a <em>page</em> in the <em>pages</em> directory turns in to html but something\nthat took a while for me to understand was how to create pages from the data that was fetched by the\n<em>sources</em>.</p>\n<p>The answer was that at <em>build time</em> Gatsby tries to call a function, defined in <em>gatsby-node.js</em>, called\n<em>createPages</em>. In this method you can query for data with GraphQL and then call <em>createPage</em> to create\nthe page.</p>\n<p>I won't go in to much details about how to write this method. If you want to know more I would recommend\nreading the official documentation <a href=\"https://www.gatsbyjs.org/tutorial/part-seven/\">here</a>.</p>\n<h3>What Finally Made It Click</h3>\n<p>Okay so the thing that finally made it click for me was to imagine that I was writing a <em>express</em> server\nwith server side rendering. Gatsby will then pre-cache all the endpoints and stored them in the\n<em>public</em> directory.</p>\n<p>So adding a file in the <em>pages</em> directory can be seen as writing:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/index'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And the <em>gatsby-node.js</em> file can be used to express endpoints that, in a <em>express</em> app, would be dynamic:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">app<span class=\"token punctuation\">.</span><span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/posts/:postId'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Closing Thoughts</h3>\n<p>Gatsby is amazing! There are a lot of plugins and things that you can add. This can feel daunting at first\nbut most of these plugins are <em>nice</em> to have but in no way required. So starting out with the basic\n<em>hello world</em> starter kit and then adding plugins as you need is probably the best way to get started.</p>\n<p>Here is a list of plugins that I currently use, as of writing this post:</p>\n<ul>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-source-filesystem/\">filesystem</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-catch-links/\">catch-links</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-react-helmet/\">react-helmet</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-styled-components/\">styled-components</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\">remark</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-remark-prismjs/\">prismjs</a></li>\n<li><a href=\"https://www.gatsbyjs.org/packages/gatsby-plugin-typography/\">typography</a></li>\n</ul>\n<p>I found that, for me, thinking of it as an <em>express</em> server made it click. Hopefully someone else can benefit\nfrom this mental model too.</p>","excerpt":"This blog was made with  Gatsby.js . Over all it has\nbeen a blast to make and the fact that I could reuse my react skills made me\nfeel like I am in control. There were however some things that took…","frontmatter":{"title":"How I Made This Blog","path":"/posts/how-i-made-this-blog"}}}]},"file":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBAX/xAAXAQEBAQEAAAAAAAAAAAAAAAABAgME/9oADAMBAAIQAxAAAAGebTTNSBPLkdOdwH//xAAbEAACAwADAAAAAAAAAAAAAAABEQACEgQiQf/aAAgBAQABBQI6zUOUKF+TRPoxBPCTP//EABYRAQEBAAAAAAAAAAAAAAAAABABEf/aAAgBAwEBPwHSn//EABoRAAICAwAAAAAAAAAAAAAAAAABAhAREjH/2gAIAQIBAT8BSz02I1//xAAeEAAABAcAAAAAAAAAAAAAAAAAAQIRECAhMUGBof/aAAgBAQAGPwJRsMhgaanuF+yf/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARITFBUWH/2gAIAQEAAT8hNhg9iC0HcS96ypnOssQa98258EJonAZY5n//2gAMAwEAAgADAAAAEND3QP/EABgRAQEBAQEAAAAAAAAAAAAAAAEAESEx/9oACAEDAQE/EDHSQW9Wt//EABgRAQEBAQEAAAAAAAAAAAAAAAEAESEx/9oACAECAQE/EO4ggzLyyF//xAAcEAEAAwEAAwEAAAAAAAAAAAABABEhMUFRkbH/2gAIAQEAAT8QyGAbVOX4l1TVLEsuJwTYv0rNQJ6bPhcQag26G1HgDWdRAXj2ICAN/jBZZe8J/9k=","width":125,"height":125,"src":"/static/f3f88991ec6ffdfd4fa6572c5fed67d6/7717f/profile.jpg","srcSet":"/static/f3f88991ec6ffdfd4fa6572c5fed67d6/7717f/profile.jpg 1x,\n/static/f3f88991ec6ffdfd4fa6572c5fed67d6/718d9/profile.jpg 1.5x,\n/static/f3f88991ec6ffdfd4fa6572c5fed67d6/5e3bc/profile.jpg 2x"}}}},"pageContext":{}}