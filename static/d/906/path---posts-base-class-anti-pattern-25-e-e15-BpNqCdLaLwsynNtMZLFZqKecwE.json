{"data":{"markdownRemark":{"html":"<p>As a consultant I get to see a lot of code bases and on Android, by far, the most common\nanti-pattern that I find is what I call the BaseClass anti-pattern.</p>\n<p>In this article I will explain what it is, why it is bad and why it is so seductive.</p>\n<h3>What is it?</h3>\n<p>So what is the BaseClass anti-pattern and how do I detect it?</p>\n<ol>\n<li>Start out by opening the android project.</li>\n<li>Locate an activity or a fragment class.</li>\n<li>Does it extend something called <em>BaseActivity</em> or <em>BaseFragment</em>?</li>\n</ol>\n<p>If the answer to #3 is yes then you my friend has fallen victim to the BaseClass anti-pattern.\nIf you open the <em>BaseActivity</em> or the <em>BaseFragment</em> class and that class contains more than\n50 lines of code then you're probably in deep trouble.</p>\n<h3>So why is this bad?</h3>\n<p>I will answer why it is bad by asking a question. What is the responsibility of the\n<em>BaseActivity</em>? Except for being an <em>Activity</em> what does the class name tell you?\n<strong>NOTHING</strong> right...</p>\n<p>So the naming is bad, lets give it a better name! Well if you open the class\nchances are that you will find something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseActivity</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AppCompatActivity</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token annotation punctuation\">@Inject</span>\n  Analytics analytics<span class=\"token punctuation\">;</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    AppInjector<span class=\"token punctuation\">.</span><span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token annotation punctuation\">@Override</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    analytics<span class=\"token punctuation\">.</span><span class=\"token function\">trackScreen</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now try to come up with a name for this class, what is it responsible for?\n<em>ActivityWithInjectionAndAnalytics</em> is not a very nice name and the <em>\"And\"</em> part indicates\nthat the class has more than one responsibility and therefore is in violation\nof the <em>single responsibility principle</em>. So people resort to calling it things like\n<em>BaseActivity</em> and this creates a very <em>non-explicit</em> abstraction. Extending <em>BaseActivity</em> tells\nyou nothing about what code you are bringing to your newly created activity.</p>\n<p>So now you might think to your self that \"This doesn't look too bad\" and i would admit\nthat no, two methods are not the end of the world. However this is usually not where the\nstory ends. I have found the size of such a <em>BaseClass</em> usually has a linear correlation with time.\nIt starts to accumulate things like creating a <em>ViewModel</em> / <em>Presenter</em>, adding utility\nfunctions that depend on a <em>Context</em> and sometimes even implementing business logic.</p>\n<p>As time goes on people start to extend <em>BaseActivity</em> almost as a ritual rather than\nout of a need for some functionality that <em>BaseActivity</em> provides. Maybe you only care about\none of the 150 methods overridden in the <em>BaseActivity</em>. Once you get to that\npoint you have effectively created a <em>static</em> dependency on code that you don't have to depend on.\nYou run code that doesn't have to run. Maybe the fact that the extra code gets executed doesn't hurt you\n(right now) but it will still execute and I absolutely promise you that one day, someone (maybe you)\nwil modify some of the code in the <em>BaseActivity</em> to fit the need of a completely unrelated class and the\nclass that you wrote in the first place will have a <em>RuntimeException</em>. You or your colleague will be blamed,\nfired and die alone.</p>\n<h3>So why use a BaseClass?</h3>\n<p>I can only guess why other people do it but as someone who has created plenty of <em>BaseClasses</em> in the past\nI can say that, for me, it was mostly due to two things.</p>\n<ul>\n<li>It was the easiest way of writing DRY (Do not repeat yourself) code.</li>\n<li>Android specific classes aren't that suited for the <a href=\"https://en.wikipedia.org/wiki/Decorator_pattern\">decorator pattern</a>.</li>\n</ul>\n<p>I probably had some piece of code, like injecting dependencies, that I thought: \"Hey I inject\nall of my activities in <em>onCreate</em>! That is duplicated code... lets get rid of that!\". So I created\nmy initial <em>BaseActivity</em> to handle the injection and started hacking away. Later on I would find some\nother piece of code that I would run in a lot of the activities, for instance converting from <em>dp</em> to <em>px</em>.\nTo do this I required access to a <em>Context</em>. Since I learned in school that OOP is all about dat\ninheritance I just added a method to the <em>BaseClass</em> that did this conversion. Of course what I should have\ndone was creating a static method in a utility class:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Units</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">dpToPx</span><span class=\"token punctuation\">(</span>Context context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">float</span> dp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Resources resources <span class=\"token operator\">=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">getResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> TypedValue<span class=\"token punctuation\">.</span><span class=\"token function\">applyDimension</span><span class=\"token punctuation\">(</span>\n        TypedValue<span class=\"token punctuation\">.</span>COMPLEX_UNIT_DIP<span class=\"token punctuation\">,</span>\n        dp<span class=\"token punctuation\">,</span>\n        resources<span class=\"token punctuation\">.</span><span class=\"token function\">getDisplayMetrics</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now any class that needs this can call it. There is simply no need to inherit any <em>BaseClass</em> so the\ncaller of the method can sleep safe knowing that nothing strange runs in <em>onStart</em>, <em>onCreate</em> or any of\nthe other callback methods that belong to the <em>Activity</em>.</p>\n<p>If you can't get by with using a static helper method then create a class that handles your use case and\ninstantiate it in the <em>Activity</em>. Better yet, inject it with your dependency injector of choice!</p>\n<p>But what if we need to run something that depends on the callback methods, like subscribing to some\nobservable data and then unsubscribing later on? Well in this case i would still prefer to be <em>explicit</em>\nover implementing it the <em>implicit</em> way with a <em>BaseClass</em>. Luckily we have even better options today with\n<a href=\"https://developer.android.com/topic/libraries/architecture/lifecycle\">LifecycleObserver</a>.</p>\n<h3>Conclusion</h3>\n<p>DO <strong>NOT</strong> CREATE A BASE CLASS FOR ALL OF YOUR ACTIVITIES AND FRAGMENTS!</p>\n<ul>\n<li>It creates implicit, but very strong, coupling between your code and code that you probably, mostly, don't even care about.</li>\n<li>It makes it very hard to get a full picture of what an class does.</li>\n<li>It will grow and become a hot mess.</li>\n<li>There is probably a lot of code in the <em>BaseClass</em> that would be really easy to unit test if it was in it's own class,\nbut the fact that it is in the <em>BaseClass</em> makes you unwilling or unable to test it.</li>\n</ul>\n<p>This is very much a rant and an opinion piece and I would love to hear your opinion on the matter!</p>","frontmatter":{"path":"/posts/base-class-anti-pattern","title":"The BaseClass Anti-Pattern"}}},"pageContext":{}}